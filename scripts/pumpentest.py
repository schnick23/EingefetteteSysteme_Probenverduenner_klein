import motorcontroller
import HubTisch
import LinearFuehrung
import Spritzkopf
import pumpenSteuerung
import time
import json
import RPi.GPIO as GPIO

GPIO.cleanup()
print("GPIO cleaned up.")
with open('config.json', 'r') as f:
    config = json.load(f)
pump1= config["gpio"]["relais"]["relais1"]
pump2= config["gpio"]["relais"]["relais2"]
pump3= config["gpio"]["relais"]["relais3"]
pump4= config["gpio"]["relais"]["relais4"]
pump5= config["gpio"]["relais"]["relais5"]
relais6= config["gpio"]["relais"]["relais6"]
relais7= config["gpio"]["relais"]["relais7"]
relais8= config["gpio"]["relais"]["relais8"]
pumpen_controller = pumpenSteuerung.Pumpen(pump1, pump2, pump3, pump4, pump5, relais6, relais7, relais8)

pumpe = input("Welche Pumpe soll getestet werden (1-5) oder 'a' für alle Pumpen? ")



tot_zeit=0
while True:
    try:
        zeit = input("Geben Sie die Laufzeit der Pumpen in Sekunden ein: ")
        if zeit == "i":
            print(tot_zeit)
        elif zeit == "q":
            print("Programm wird beendet.")
            print("Gesamtzeit der Pumpenläufe: ", tot_zeit, " Sekunden.")
            GPIO.cleanup()
            exit()
        elif zeit == "dir":
            pumpen_controller.changeDir()
        else:
            zeit = float(zeit)
            if pumpe == 'a':
                pumpen_controller.all_on()
            else:
                pumpe_num = int(pumpe)
                pumpen_controller.all_on([pumpe_num])
            time.sleep(zeit)
            pumpen_controller.all_off()
            tot_zeit += zeit
    except KeyboardInterrupt:
        pumpen_controller.all_off()
        GPIO.cleanup()
        print("❌ Manuell abgebrochen.")
        break
    



#pumpen_controller.changeDir(False)
#pumpen_controller.all_on()
#time.sleep(7)
#pumpen_controller.all_off()
#pumpen_controller.changeDir(True)
#pumpen_controller.all_on()
#time.sleep(7)
#pumpen_controller.all_off()